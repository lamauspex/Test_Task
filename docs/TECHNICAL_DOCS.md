# Crypto Price Tracker ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üü¢ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ ‚úÖ
1. –ö–ª–∏–µ–Ω—Ç Deribit API ‚Äî `clients/deribit_client.py` (aiohttp)
2. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö ‚Äî Celery Beat –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
3. –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL ‚Äî SQLAlchemy async + asyncpg
4. REST API –Ω–∞ FastAPI ‚Äî 3 GET –º–µ—Ç–æ–¥–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
5. Docker Compose ‚Äî 5 —Å–µ—Ä–≤–∏—Å–æ–≤ (app, worker, beat, postgres, redis)

### –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ ‚úÖ
1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç (aiohttp)
2. Unit-—Ç–µ—Å—Ç—ã —Å pytest

---

## üü¢ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Docker Network                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ   Redis   ‚îÇ  ‚îÇPostgreSQL ‚îÇ  ‚îÇ   FastAPI ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ  (Broker) ‚îÇ  ‚îÇ    (DB)   ‚îÇ  ‚îÇ   (API)   ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ        ‚îÇ              ‚îÇ              ‚îÇ                      ‚îÇ
‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îÇ
‚îÇ                       ‚îÇ                                     ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îÇ
‚îÇ         ‚îÇ      Celery Beat          ‚îÇ  (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)        ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îÇ
‚îÇ                       ‚îÇ                                     ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îÇ
‚îÇ         ‚îÇ     Celery Worker         ‚îÇ  (–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å)        ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ–í–Ω–µ—à–Ω–∏–π API: Deribit (https://www.deribit.com/api/v2/public) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Clean Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   API Layer                         ‚îÇ
‚îÇ              (src/api/routes.py)                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                Service Layer                        ‚îÇ
‚îÇ          (src/services/price_service.py)            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ               Repository Layer                      ‚îÇ
‚îÇ        (src/repositories/price_repository.py)       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                  Data Layer                         ‚îÇ
‚îÇ      (src/models/models.py, database.py)            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ               External API                          ‚îÇ
‚îÇ           (clients/deribit_client.py)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üü¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
crypto-price-tracker/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ celery_app.py              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Celery
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py              # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ clients/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ deribit_client.py      # –ö–ª–∏–µ–Ω—Ç Deribit (aiohttp)
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                # –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py            # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.py                 # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py            # PostgreSQL
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ celery.py              # Celery + Redis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deribit.py             # Deribit API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis.py               # Redis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py             # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring.py          # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py            # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dependencies.py        # FastAPI dependencies
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ uow.py                 # Unit of Work
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py              # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ price_repository.py    # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                # –ë–∞–∑–æ–≤—ã–µ —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ requests.py            # –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ responses.py           # –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ price_service.py       # Business Logic
‚îÇ   ‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ price_fetcher.py       # Celery –∑–∞–¥–∞—á–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exception_handler.py   # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ business.py            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ exceptions/
‚îÇ       ‚îî‚îÄ‚îÄ exceptions.py          # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ clients/
‚îÇ   ‚îî‚îÄ‚îÄ deribit_client.py          # –ö–ª–∏–µ–Ω—Ç Deribit (–≤–Ω–µ DI)
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ test_repository_architecture.py
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ entrypoint.sh
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

## üü¢ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Deribit Client (`clients/deribit_client.py`)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç –Ω–∞ aiohttp:

```python
class DeribitClient:
    async def fetch_price(self, ticker: str) -> PriceData: ...
    async def fetch_all_prices(self) -> Dict[str, PriceData]: ...
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç Protocol (`IDeribitClient`) –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö.

### 2. Price Service (`src/services/price_service.py`)

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º UnitOfWork:

```python
class PriceService:
    async def fetch_and_save_all_prices(self, uow: UnitOfWork): ...
    async def get_prices_by_ticker(self, uow: UnitOfWork, ticker: str): ...
    async def get_latest_price(self, uow: UnitOfWork, ticker: str): ...
```

### 3. Unit of Work (`src/database/uow.py`)

–ü–∞—Ç—Ç–µ—Ä–Ω UoW –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏:

```python
async with UnitOfWork(db) as uow:
    await uow.prices.save_price_data(...)
    await uow.commit()  # –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

### 4. Celery Tasks (`src/tasks/price_fetcher.py`)

–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ —Å–±–æ—Ä–∞ —Ü–µ–Ω:

```python
@celery_app.task
def fetch_crypto_prices():
    # –ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—ã ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PostgreSQL
```

---

## üü¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª—å PriceRecord

```python
class PriceRecord(BaseModel):
    ticker: Mapped[str] = mapped_column(String(20), nullable=False, index=True)
    price: Mapped[Decimal] = mapped_column(DECIMAL(20, 8), nullable=False)
    timestamp: Mapped[int]  # Unix timestamp
```

### –ò–Ω–¥–µ–∫—Å—ã

- `idx_ticker` ‚Äî –ø–æ–∏—Å–∫ –ø–æ —Ç–∏–∫–µ—Ä—É
- `idx_timestamp` ‚Äî —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏

---

## üü¢ API Endpoints

### GET `/api/v1/prices/all`

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –æ —Ü–µ–Ω–∞—Ö –¥–ª—è —Ç–∏–∫–µ—Ä–∞.

**Query parameters:**
- `ticker` (required): `btc_usd` –∏–ª–∏ `eth_usd`
- `limit` (optional): –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000)
- `offset` (optional): —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

**Response:**
```json
[
  {"ticker": "btc_usd", "price": 50000.00, "timestamp": 1705000000, "created_at": "..."}
]
```

### GET `/api/v1/prices/latest`

–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Ü–µ–Ω—É –¥–ª—è —Ç–∏–∫–µ—Ä–∞.

**Query parameters:**
- `ticker` (required): `btc_usd` –∏–ª–∏ `eth_usd`

**Response:**
```json
{
  "ticker": "btc_usd",
  "price": 50000.00,
  "timestamp": 1705000000,
  "fetched_at": "..."
}
```

### GET `/api/v1/prices/date-range`

–ü–æ–ª—É—á–∏—Ç—å —Ü–µ–Ω—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –¥–∞—Ç.

**Query parameters:**
- `ticker` (required): `btc_usd` –∏–ª–∏ `eth_usd`
- `start_date` (required): –Ω–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (Unix timestamp)
- `end_date` (required): –∫–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (Unix timestamp)
- `limit` (optional): –ª–∏–º–∏—Ç –∑–∞–ø–∏—Å–µ–π

**Response:**
```json
{
  "ticker": "btc_usd",
  "start_date": 1704067200,
  "end_date": 1704153600,
  "count": 10,
  "prices": [...]
}
```

---

## üü¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ì—Ä—É–ø–ø–∞ | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ |
|--------|------------|
| **app** | `HOST`, `PORT`, `DEBUG`, `API_TITLE` |
| **database** | `DB_HOST`, `DB_PORT`, `DB_USER`, `DB_PASSWORD`, `DB_NAME` |
| **celery** | `BROKER_URL`, `RESULT_BACKEND`, `FETCH_INTERVAL` |
| **deribit** | `DERIBIT_API_URL` |
| **redis** | `REDIS_HOST`, `REDIS_PORT` |
| **logging** | `LOG_LEVEL`, `LOG_FORMAT` |

---

## üü¢ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è |
|-----------|--------|
| FastAPI | 0.128.0 |
| SQLAlchemy | 2.0.45 |
| asyncpg | 0.31.0 |
| Celery | 5.4.0 |
| aiohttp | 3.13.3 |
| Pydantic | 2.12.5 |
| Redis | 5.2.1 |
| PostgreSQL | 15 |
| pytest | 9.0.2 |

---

## üü¢ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ



### –¢–µ—Å—Ç—ã


---

## üü¢ Design Decisions

### –ü–æ—á–µ–º—É aiohttp –≤–º–µ—Å—Ç–æ requests?

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π HTTP-–∫–ª–∏–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –í—ã–ø–æ–ª–Ω—è—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API Deribit
- –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å FastAPI –≤–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö API
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ

### –ü–æ—á–µ–º—É Redis –¥–ª—è Celery?

- –ë—ã—Å—Ç—Ä—ã–π in-memory –±—Ä–æ–∫–µ—Ä
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Celery
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

### Clean Architecture

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å (–∫–∞–∂–¥—ã–π —Å–ª–æ–π –º–æ–∂–Ω–æ –º–æ–∫–∞—Ç—å)
- –ó–∞–º–µ–Ω–∏–º–æ—Å—Ç—å (–ª–µ–≥–∫–æ —Å–º–µ–Ω–∏—Ç—å –ë–î –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π API)
- –ß–∏—Å—Ç–æ—Ç—É –∫–æ–¥–∞ (–∫–∞–∂–¥–∞—è —á–∞—Å—Ç—å –¥–µ–ª–∞–µ—Ç –æ–¥–Ω—É –≤–µ—â—å)

### Dependency Injection

FastAPI `Depends()` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –º–æ–∫–∞–º–∏
- –ù–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –Ø–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º